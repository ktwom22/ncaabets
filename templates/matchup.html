{% extends "base.html" %}

{% block title %}{{ g.full_stats.away_name }} @ {{ g.full_stats.home_name }} | Edge Pro{% endblock %}

{% block extra_css %}
<style>
    /* --- THEME SYNC --- */
    :root {
        --card-border-heavy: #0f172a;
        --highlight-bg: rgba(59, 130, 246, 0.08);
    }
    [data-theme="dark"] {
        --card-border-heavy: #000000;
        --highlight-bg: rgba(59, 130, 246, 0.15);
    }

    /* Hero Section */
    .matchup-header {
        background: var(--card-bg);
        padding: 40px 0;
        border-bottom: 2.5px solid var(--card-border-heavy);
    }

    .header-logo {
        width: 100px; height: 100px; object-fit: contain;
        filter: drop-shadow(0 8px 16px rgba(0,0,0,0.3));
    }

    /* --- THE PICK HIGHLIGHT --- */
    .highlight-side {
        background: var(--highlight-bg) !important;
        border: 2.5px solid var(--primary) !important;
        border-radius: 24px;
        padding: 20px 10px;
        position: relative;
        box-shadow: 0 10px 30px rgba(59, 130, 246, 0.1);
    }

    .pick-label-hero {
        position: absolute;
        top: -12px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--primary);
        color: white;
        font-size: 0.65rem;
        font-weight: 900;
        padding: 4px 12px;
        border-radius: 20px;
        white-space: nowrap;
        border: 2px solid var(--card-border-heavy);
    }

    /* Proj Pills */
    .projection-pill {
        background: var(--inner-lift);
        border: 2px solid var(--card-border-heavy);
        padding: 12px;
        border-radius: 16px;
        margin-top: 15px;
    }
    .proj-val { font-size: 1.6rem; font-weight: 900; color: var(--text-main); line-height: 1; }

    /* ESPN Frame */
    .chart-viewport {
        width: 100%; height: 520px; overflow: hidden; position: relative;
        border-radius: 24px; border: 2.5px solid var(--card-border-heavy); background: #000;
    }
    .chart-viewport iframe {
        position: absolute; top: -245px; left: 50%; transform: translateX(-50%);
        width: 1200px; height: 1100px; border: none;
        transform-origin: top center;
    }

    /* Intel & Analytics Cards */
    .analysis-container {
        background: var(--card-bg);
        border-radius: 24px;
        border: 2.5px solid var(--card-border-heavy);
        overflow: hidden;
    }

    .category-divider {
        background: var(--inner-lift); padding: 12px 20px; font-size: 0.7rem; font-weight: 900;
        color: var(--primary); text-transform: uppercase; letter-spacing: 1.5px; border-bottom: 2px solid var(--card-border-heavy);
    }

    .stat-grid-row {
        display: flex; align-items: center; padding: 14px 20px;
        border-bottom: 1.5px solid var(--card-border-heavy);
    }

    .grid-val { width: 30%; font-size: 1.1rem; font-weight: 800; }
    .grid-label { width: 40%; text-align: center; font-size: 0.65rem; font-weight: 700; color: var(--text-dim); text-transform: uppercase; }
    .text-home { color: var(--primary); text-align: right; }
    .text-away { color: var(--text-main); text-align: left; }

    .edge-footer {
        background: var(--primary); padding: 25px; text-align: center; color: white;
        border-top: 2.5px solid var(--card-border-heavy);
    }

    @media (max-width: 768px) {
        .header-logo { width: 60px; height: 60px; }
        .chart-viewport { height: 300px; }
        .chart-viewport iframe { transform: translateX(-50%) scale(0.5); top: -120px; }
    }
</style>
{% endblock %}

{% block content %}
<div class="matchup-header">
    <div class="container">
        <div class="row align-items-center g-3 text-center">

            <div class="col-4">
                <div class="{% if g.Pick == g.full_stats.away_name %}highlight-side{% endif %}">
                    {% if g.Pick == g.full_stats.away_name %}<div class="pick-label-hero">SYSTEM PICK</div>{% endif %}
                    <img src="{{ g.L_Logo if g.L_Logo and g.L_Logo != 'nan' else 'https://a.espncdn.com/combiner/i?img=/i/teamlogos/ncaa/500/default.png' }}" class="header-logo mb-2">
                    <h3 class="fw-black mb-0">{{ g.full_stats.away_name }}</h3>
                </div>
                <div class="projection-pill mx-auto" style="max-width: 140px;">
                    <div class="stat-label">PROJECTION</div>
                    <div class="proj-val">{{ g.Left_Proj }}</div>
                </div>
            </div>

            <div class="col-4">
                {% if g.status_state == 'in' or g.is_locked %}
                    <div class="stat-label mb-1 {{ 'text-danger' if not g.is_locked else 'text-warning' }}">
                        {{ 'üîí LOCKED' if g.is_locked else '‚óè LIVE SCORE' }}
                    </div>
                    <div class="display-4 fw-black" style="letter-spacing: -3px;">{{ g.Live_Score }}</div>
                {% else %}
                    <div class="h6 fw-bold text-dim mb-2">TIP-OFF</div>
                    <div class="display-5 fw-black opacity-25">VS</div>
                {% endif %}
                <div class="mt-3">
                    <span class="badge bg-dark border border-2 border-primary px-3 py-2 rounded-pill fw-black">
                        PICK: {{ g.Pick_Spread }}
                    </span>
                </div>
            </div>

            <div class="col-4">
                <div class="{% if g.Pick == g.full_stats.home_name %}highlight-side{% endif %}">
                    {% if g.Pick == g.full_stats.home_name %}<div class="pick-label-hero">SYSTEM PICK</div>{% endif %}
                    <img src="{{ g.R_Logo if g.R_Logo and g.R_Logo != 'nan' else 'https://a.espncdn.com/combiner/i?img=/i/teamlogos/ncaa/500/default.png' }}" class="header-logo mb-2">
                    <h3 class="fw-black mb-0 text-primary">{{ g.full_stats.home_name }}</h3>
                </div>
                <div class="projection-pill mx-auto" style="max-width: 140px; border-color: var(--primary);">
                    <div class="stat-label text-primary">PROJECTION</div>
                    <div class="proj-val text-primary">{{ g.Right_Proj }}</div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container mt-5 mb-5">
    <div class="row g-4">
        <div class="col-lg-7">
            <h5 class="fw-black mb-3 text-uppercase" style="letter-spacing: 1px;">Pre-Game Intelligence</h5>
            <div class="analysis-container p-4 mb-4">
                <div class="row text-center g-3">
                    <div class="col-6">
                        <div class="stat-label">Broadcast</div>
                        <div class="fw-bold">{{ g.intel.broadcast }}</div>
                    </div>
                    <div class="col-6 border-start border-2" style="border-color: var(--card-border-heavy) !important;">
                        <div class="stat-label">Location</div>
                        <div class="fw-bold small">{{ g.intel.venue }}</div>
                    </div>
                </div>
            </div>

            <h5 class="fw-black mb-3 text-uppercase" style="letter-spacing: 1px;">Win Probability Flow</h5>
            {% if g.status_state in ['in', 'post'] %}
                <div class="chart-viewport">
                    <iframe src="https://www.espn.com/mens-college-basketball/gamecast?gameId={{ g.ESPN_ID }}"></iframe>
                </div>
            {% else %}
                <div class="analysis-container d-flex flex-column align-items-center justify-content-center" style="height: 350px; border: 3px dashed var(--card-border-heavy);">
                    <div class="display-4 mb-2">üïí</div>
                    <h6 class="fw-black text-dim">TRACKER INITIALIZES AT TIP-OFF</h6>
                </div>
            {% endif %}
        </div>

        <div class="col-lg-5">
            <h5 class="fw-black mb-3 text-uppercase" style="letter-spacing: 1px;">System Analytics</h5>
            <div class="analysis-container shadow-sm">
                <div class="category-divider">Scoring & Momentum</div>
                <div class="stat-grid-row">
                    <div class="grid-val text-away">{{ g.full_stats.ppg_a }}</div>
                    <div class="grid-label">Season PPG</div>
                    <div class="grid-val text-home">{{ g.full_stats.ppg_h }}</div>
                </div>
                <div class="stat-grid-row">
                    <div class="grid-val text-away text-primary">{{ g.full_stats.l3_ppg_a }}</div>
                    <div class="grid-label">L3 Momentum</div>
                    <div class="grid-val text-home text-primary">{{ g.full_stats.l3_ppg_h }}</div>
                </div>

                <div class="category-divider">Defense & Ranking</div>
                <div class="stat-grid-row">
                    <div class="grid-val text-away">{{ g.full_stats.ppga_a }}</div>
                    <div class="grid-label">Allowed</div>
                    <div class="grid-val text-home">{{ g.full_stats.ppga_h }}</div>
                </div>
                <div class="stat-grid-row">
                    <div class="grid-val text-away">#{{ g.full_stats.rank_a | int }}</div>
                    <div class="grid-label">NET Rank</div>
                    <div class="grid-val text-home">#{{ g.full_stats.rank_h | int }}</div>
                </div>

                <div class="edge-footer">
                    <div class="small fw-bold text-white-50 text-uppercase mb-1">Model Value Edge</div>
                    <div class="display-5 fw-black">+{{ g.Edge }}%</div>
                </div>
            </div>

            <a href="/" class="btn btn-dark w-100 mt-4 rounded-pill fw-black py-3" style="border: 2.5px solid var(--card-border-heavy);">
                ‚Üê BACK TO DASHBOARD
            </a>
        </div>
    </div>
</div>
{% endblock %}